<?xml version="1.0" encoding="UTF-8"?>
<sparqlMap namespace="myTestNamespace"
	xmlns="http://mayo.edu/twinkql" 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://mayo.edu/twinkql ../../../main/castor/twinkql.xsd ">
	
	<compositeResultMap id="testNested" resultClass="edu.mayo.twinkql.result.TestResultNested">
		<tripleMap var="p" varType="localName" predicateUri="asdf" beanProperty="test.bean.prop"/>
	</compositeResultMap>

	<compositeResultMap id="test" resultClass="edu.mayo.twinkql.result.TestResult">
		<discriminator var="p" varType="localName" predicateUri="asdf">
			<case value="1" resultMapping="mapping1"/>
			<case value="2" resultMapping="mapping2"/>
		</discriminator>
		<nestedResultMap resultMap="testNested" beanProperty="test.bean.nested"/>
		<if function="dsaf" param="p">
			<nestedResultMap resultMap="testNested" beanProperty="test.bean.nested"/>
		</if>
		<tripleMap var="p" varType="localName" predicateUri="asdf" beanProperty="test.bean.prop"/>	
		<tripleMap var="p" varType="localName" predicateUri="asdf" callbackId="callbackId"/>	
		<if function="dsaf" param="p">
			<tripleMap var="p" varType="localName" predicateUri="asdf" callbackId="callbackId"/>	
		</if>
	</compositeResultMap>
	
	<perRowResultMap id="codeSystemVersionReferenceResultMap" 
		resultClass="edu.mayo.cts2.framework.model.core.CodeSystemVersionReference"
		afterMap="spring:codeSystemVersionReferenceHrefCallback">
		<nestedResultMap beanProperty="version" resultMap="myTestNamespace:test"/>
		<nestedResultMap beanProperty="codeSystem" resultMap="myTestNamespace:test"/>
	</perRowResultMap>
	
	<select id="getAssociationDirectoryEntrySummaries" resultMap="associationDirectoryEntryResultMap">
		<![CDATA[
		SELECT ?s ?p ?o
		WHERE {	
		<isNotNull property="restrictToCodeSystemVersion">
		    GRAPH bpOntologies:#{restrictToCodeSystemVersion} {	
		    ?s ?p ?o .
      		FILTER (isIRI(?s))
      		FILTER (isIRI(?p))
      		FILTER (isIRI(?o))
      		}
		</isNotNull>
      	<isNotNull property="restrictToSourceEntityName">
      		FILTER (CONTAINS( UCASE(str(?s)), UCASE( '#{restrictToSourceEntityName}')))
		</isNotNull>	
      	<isNotNull property="restrictToTargetEntityName">
      		FILTER (CONTAINS( UCASE(str(?t)), UCASE( '#{restrictToTargetEntityName}')))
		</isNotNull>	
		<isNotNull property="restrictToPredicateName">
      		FILTER (CONTAINS( UCASE(str(?p)), UCASE( '#{restrictToPredicateName}')))
		</isNotNull>
		<isNotNull property="restrictToSourceEntityUri">
      		FILTER (?s = <#{restrictToSourceEntityUri}>)
		</isNotNull>	
      	<isNotNull property="restrictToTargetEntityUri">
      		FILTER (?t = <#{restrictToTargetEntityUri}>)
		</isNotNull>	
		<isNotNull property="restrictToPredicateUri">
      		FILTER (?p = <#{restrictToPredicateUri}>)
		</isNotNull>		
		} 
		LIMIT 10
	    
		
		]]>
	</select>
	

	<select id="myTestQuery">
	SELECT DISTINCT ?p ?o
	 WHERE {
	  GRAPH ?graphURI {
	   <![CDATA[ ?s a <http://www.w3.org/2002/07/owl#Ontology>;]]>
	   ?p ?o
	  }
	 }
	</select>
	
	<select id="testIterativeQuery">
		 SELECT DISTINCT ?p ?o
			 WHERE {
			  GRAPH ?graphURI {
			   <![CDATA[ ?s a <http://www.w3.org/2002/07/owl#Ontology>;]]>
			   ?p ?o
			
			  }
			  
			 <isNotNull property="someProp1">
			 	Test for inner #{sub}
			 </isNotNull>
			 something
			 <iterator property="myCollection" collection="." open="FILTER(" close=")" separator="&amp;&amp;">
			 	REGEX( ?#{item.var}, '#{item.text}' )
			 </iterator>
			 else
			 <isNotNull property="someProp2">
			 	DO something else..
			 </isNotNull>
			 }
	</select>
	
</sparqlMap>
